<!DOCTYPE html>

<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0C0C0E">
  <title>Protocole R√©√©ducation</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    :root {
      --bg: #0C0C0E; --bg-card: #18181B; --bg-card-hover: #1F1F23;
      --text: #FAFAFA; --text-2: #A1A1AA; --text-3: #71717A;
      --border: #27272A; --green: #22C55E; --orange: #F59E0B; --red: #EF4444;
      --radius: 16px; --radius-lg: 24px;
    }
    body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; min-height: 100dvh; -webkit-font-smoothing: antialiased; }
    #app { max-width: 430px; margin: 0 auto; min-height: 100vh; min-height: 100dvh; position: relative; padding: 20px; padding-top: 40px; padding-bottom: 40px; }

```
/* DATE PICKER */
.date-picker { display: flex; align-items: center; justify-content: center; gap: 16px; margin-bottom: 24px; }
.date-btn { width: 44px; height: 44px; border-radius: 50%; border: none; background: var(--bg-card); color: var(--text); display: flex; align-items: center; justify-content: center; cursor: pointer; }
.date-btn:active { background: var(--bg-card-hover); }
.date-btn svg { width: 24px; height: 24px; }
.date-display { text-align: center; }
.date-display .day { font-size: 28px; font-weight: 800; }
.date-display .month { font-size: 14px; color: var(--text-2); }

/* PROGRESS BAR */
.progress-section { margin-bottom: 24px; }
.progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.progress-header span { font-size: 13px; color: var(--text-2); }
.progress-header strong { font-size: 13px; color: var(--green); }
.progress-bar { height: 8px; background: var(--bg-card); border-radius: 4px; overflow: hidden; }
.progress-fill { height: 100%; background: linear-gradient(90deg, #22C55E, #10B981); border-radius: 4px; transition: width 0.3s; }
.period-info { text-align: center; margin-top: 12px; padding: 12px; background: var(--bg-card); border-radius: var(--radius); }
.period-info .label { font-size: 12px; color: var(--text-3); }
.period-info .value { font-size: 15px; font-weight: 600; margin-top: 4px; }

/* HEADER */
.header { text-align: center; margin-bottom: 24px; }
.header h1 { font-size: 22px; font-weight: 800; margin-bottom: 4px; }
.header p { font-size: 14px; color: var(--text-2); }

/* EXERCISE LIST */
.ex-list { display: flex; flex-direction: column; gap: 12px; }
.ex-card { display: flex; align-items: center; padding: 16px; background: var(--bg-card); border-radius: var(--radius); cursor: pointer; position: relative; overflow: hidden; transition: transform 0.15s, background 0.15s; }
.ex-card:active { transform: scale(0.98); background: var(--bg-card-hover); }
.ex-card.done { opacity: 0.5; }
.ex-card-accent { position: absolute; left: 0; top: 0; bottom: 0; width: 4px; }
.ex-card-icon { width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 26px; margin-right: 14px; flex-shrink: 0; }
.ex-card-body { flex: 1; min-width: 0; }
.ex-card-top { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
.ex-card-top h3 { font-size: 16px; font-weight: 700; }
.ex-card-dosage { font-size: 14px; color: var(--text); background: var(--bg); padding: 6px 12px; border-radius: 8px; display: inline-block; font-weight: 600; }
.ex-card-action { margin-left: 12px; flex-shrink: 0; }
.ex-card-check { width: 32px; height: 32px; border-radius: 50%; background: var(--green); display: flex; align-items: center; justify-content: center; }
.ex-card-check svg { width: 18px; height: 18px; }
.ex-card-arrow { width: 20px; height: 20px; color: var(--text-3); }

/* STATUS */
.status-bar { display: flex; justify-content: center; gap: 8px; margin-top: 24px; }
.status-item { padding: 8px 16px; background: var(--bg-card); border-radius: 20px; font-size: 13px; color: var(--text-2); }
.status-item.done { background: rgba(34,197,94,0.2); color: var(--green); }

/* OUT OF RANGE */
.out-of-range { text-align: center; padding: 60px 20px; }
.out-of-range span { font-size: 64px; display: block; margin-bottom: 16px; }
.out-of-range h2 { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
.out-of-range p { color: var(--text-2); font-size: 14px; line-height: 1.6; }

/* EXERCISE SCREEN */
.ex-screen { position: fixed; inset: 0; background: var(--bg); z-index: 100; overflow-y: auto; display: none; }
.ex-screen.active { display: block; }
.ex-header { display: flex; align-items: center; padding: 56px 20px 16px; background: var(--bg-card); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 10; }
.ex-header h2 { flex: 1; text-align: center; font-size: 17px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 8px; }
.hdr-btn { width: 40px; height: 40px; border-radius: 50%; border: none; background: var(--bg); color: var(--text); display: flex; align-items: center; justify-content: center; cursor: pointer; }
.hdr-btn svg { width: 22px; height: 22px; }
.hdr-spacer { width: 40px; }

/* INTRO */
.intro-hero { height: 140px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
.intro-hero span { font-size: 64px; position: relative; z-index: 1; }
.intro-hero .glow { position: absolute; width: 180px; height: 180px; background: rgba(255,255,255,0.15); border-radius: 50%; filter: blur(50px); }
.intro-body { padding: 20px; padding-bottom: 120px; display: flex; flex-direction: column; gap: 16px; }
.info-block { background: var(--bg-card); padding: 16px; border-radius: var(--radius); }
.info-block h4 { display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 600; color: var(--text-2); margin-bottom: 12px; }
.info-block h4 span { font-size: 18px; }
.info-block p { font-size: 15px; line-height: 1.6; }
.info-block.success { background: rgba(34,197,94,0.15); border-left: 4px solid var(--green); }
.info-block.warning { background: rgba(245,158,11,0.15); border-left: 4px solid var(--orange); }
.info-block.dosage { background: rgba(99,102,241,0.15); border-left: 4px solid #6366F1; }
.steps-list { list-style: none; display: flex; flex-direction: column; gap: 12px; }
.steps-list li { display: flex; gap: 12px; }
.steps-list .num { width: 26px; height: 26px; border-radius: 50%; background: var(--bg); display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; flex-shrink: 0; }
.steps-list .txt { font-size: 15px; line-height: 1.5; }
.steps-list .txt strong { display: block; }
.steps-list .txt span { font-size: 13px; color: var(--text-2); }
.warn-list { list-style: none; display: flex; flex-direction: column; gap: 6px; }
.warn-list li { font-size: 15px; padding-left: 20px; position: relative; }
.warn-list li::before { content: '‚úï'; position: absolute; left: 0; color: var(--orange); font-size: 12px; }
.dosage-display { text-align: center; padding: 20px; }
.dosage-display .main { font-size: 36px; font-weight: 800; color: #6366F1; }
.dosage-display .sub { font-size: 14px; color: var(--text-2); margin-top: 8px; }
.intro-footer { position: fixed; bottom: 0; left: 0; right: 0; padding: 20px; background: linear-gradient(180deg, transparent, var(--bg) 30%); z-index: 20; display: flex; justify-content: center; }
.intro-footer > div { max-width: 430px; width: 100%; }
.btn { width: 100%; padding: 18px; border: none; border-radius: var(--radius); font-size: 17px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: transform 0.15s; }
.btn:active { transform: scale(0.98); }
.btn svg { width: 20px; height: 20px; }
.btn-primary { background: var(--text); color: var(--bg); }
.btn-secondary { background: var(--bg-card); color: var(--text-2); }

/* ACTIVE SCREEN */
.active-screen { display: none; flex-direction: column; align-items: center; padding: 40px 20px; padding-bottom: 120px; min-height: calc(100vh - 89px); position: relative; }
.active-screen.show { display: flex; }
.active-bg { position: absolute; top: 0; left: 0; right: 0; height: 50%; pointer-events: none; }

/* TIMER */
.timer { display: flex; flex-direction: column; align-items: center; gap: 32px; position: relative; z-index: 1; }
.timer-ring { position: relative; width: 220px; height: 220px; }
.timer-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
.timer-ring .track { fill: none; stroke: var(--bg-card); stroke-width: 10; }
.timer-ring .progress { fill: none; stroke-width: 10; stroke-linecap: round; transition: stroke-dashoffset 0.3s; }
.timer-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.timer-time { font-size: 52px; font-weight: 800; letter-spacing: -2px; }
.timer-label { font-size: 14px; color: var(--text-2); }
.timer-btns { display: flex; gap: 16px; }
.timer-btn { border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.timer-btn:active { transform: scale(0.95); }
.timer-btn.main { width: 72px; height: 72px; }
.timer-btn.main svg { width: 28px; height: 28px; }
.timer-btn.sec { width: 52px; height: 52px; background: var(--bg-card); color: var(--text-2); }
.timer-btn.sec svg { width: 22px; height: 22px; }

/* REP COUNTER */
.rep-counter { display: flex; flex-direction: column; align-items: center; gap: 20px; position: relative; z-index: 1; }
.set-info { font-size: 14px; color: var(--text-2); }
.rep-circle { width: 200px; height: 200px; position: relative; cursor: pointer; }
.rep-circle:active { transform: scale(0.98); }
.rep-circle svg { position: absolute; inset: 0; transform: rotate(-90deg); }
.rep-circle .track { fill: none; stroke: var(--bg-card); stroke-width: 10; }
.rep-circle .progress { fill: none; stroke-width: 10; stroke-linecap: round; transition: stroke-dasharray 0.3s; }
.rep-inner { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.rep-num { font-size: 64px; font-weight: 800; }
.rep-num .sep { font-size: 28px; color: var(--text-3); margin: 0 4px; }
.rep-num .tot { font-size: 28px; color: var(--text-2); font-weight: 600; }
.rep-hint { font-size: 13px; color: var(--text-3); }
.hold-num { font-size: 72px; font-weight: 800; color: var(--orange); }
.hold-txt { font-size: 16px; color: var(--orange); font-weight: 600; }
.rep-circle.holding { animation: pulse 1s infinite; }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
.hold-ring { position: absolute; inset: 0; border-radius: 50%; border: 3px solid var(--orange); animation: ringPulse 1s infinite; pointer-events: none; }
@keyframes ringPulse { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.15); opacity: 0; } }
.hold-info { font-size: 14px; color: var(--text-2); margin-top: 8px; }

.tip-box { margin-top: 32px; padding: 16px 20px; background: var(--bg-card); border-radius: var(--radius); display: flex; align-items: center; gap: 12px; max-width: 320px; }
.tip-box span { font-size: 20px; }
.tip-box p { font-size: 14px; color: var(--text-2); line-height: 1.4; }

/* FEEDBACK */
.feedback-screen { display: none; flex-direction: column; padding: 40px 20px; padding-bottom: 120px; min-height: calc(100vh - 89px); }
.feedback-screen.show { display: flex; }
.fb-top { text-align: center; margin-bottom: 40px; }
.fb-top span { font-size: 72px; display: block; margin-bottom: 16px; animation: bounce 0.6s; }
@keyframes bounce { 0%, 100% { transform: scale(1); } 30% { transform: scale(1.3); } 60% { transform: scale(0.9); } }
.fb-top h2 { font-size: 32px; font-weight: 800; margin-bottom: 8px; }
.fb-top p { color: var(--text-2); }
.fb-title { font-size: 20px; font-weight: 700; text-align: center; margin-bottom: 8px; }
.fb-sub { text-align: center; color: var(--text-2); font-size: 14px; margin-bottom: 24px; }
.fb-options { display: flex; flex-direction: column; gap: 12px; flex: 1; }
.fb-opt { display: flex; align-items: center; padding: 16px; background: var(--bg-card); border: 2px solid transparent; border-radius: var(--radius); cursor: pointer; transition: all 0.2s; }
.fb-opt:active { transform: scale(0.98); }
.fb-opt.selected { border-color: var(--green); }
.fb-opt.selected.orange { border-color: var(--orange); }
.fb-opt.selected.red { border-color: var(--red); }
.fb-opt .icon { font-size: 28px; margin-right: 16px; }
.fb-opt .txt { flex: 1; }
.fb-opt .txt strong { font-size: 16px; display: block; }
.fb-opt .txt span { font-size: 13px; color: var(--text-2); }
.fb-opt .check { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 0; }
.fb-opt.selected .check { opacity: 1; }
.fb-opt .check svg { width: 16px; height: 16px; fill: white; }
```

  </style>
</head>
<body>
  <div id="app"></div>
  <div id="exercise-screen" class="ex-screen"></div>

  <script>
    // ============================================
    // DONN√âES DE PROGRESSION PAR P√âRIODE (4 jours)
    // D√©but: 14 janvier 2026
    // ============================================
    
    const START_DATE = new Date(2026, 0, 14); // 14 janvier 2026
    const END_DATE = new Date(2026, 3, 14);   // 14 avril 2026
    
    // Format: [adductions, squats, chaiseMur, scapula, velo]
    // Chaque √©l√©ment: { sets, reps, holdTime, extra } ou { durationMin } pour v√©lo
    const PROGRESSION = [
      // P√©riode 0: 14-17 janv
      {
        adductions: { sets: 2, reps: 6, holdTime: 8 },
        squats: { sets: 2, reps: 6, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 15 },
        scapula: { sets: 2, reps: 5 },
        velo: { durationMin: 10 }
      },
      // P√©riode 1: 18-21 janv
      {
        adductions: { sets: 2, reps: 6, holdTime: 8 },
        squats: { sets: 2, reps: 6, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 15 },
        scapula: { sets: 2, reps: 6 },
        velo: { durationMin: 10 }
      },
      // P√©riode 2: 22-25 janv
      {
        adductions: { sets: 2, reps: 7, holdTime: 8 },
        squats: { sets: 2, reps: 7, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 20 },
        scapula: { sets: 2, reps: 7 },
        velo: { durationMin: 12 }
      },
      // P√©riode 3: 26-29 janv
      {
        adductions: { sets: 2, reps: 7, holdTime: 8 },
        squats: { sets: 2, reps: 7, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 20 },
        scapula: { sets: 2, reps: 8 },
        velo: { durationMin: 12 }
      },
      // P√©riode 4: 30 janv - 2 f√©v
      {
        adductions: { sets: 2, reps: 8, holdTime: 8 },
        squats: { sets: 2, reps: 8, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 25 },
        scapula: { sets: 2, reps: 9 },
        velo: { durationMin: 14 }
      },
      // P√©riode 5: 3-6 f√©v
      {
        adductions: { sets: 2, reps: 8, holdTime: 8 },
        squats: { sets: 2, reps: 8, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 25 },
        scapula: { sets: 2, reps: 10 },
        velo: { durationMin: 14 }
      },
      // P√©riode 6: 7-10 f√©v
      {
        adductions: { sets: 2, reps: 9, holdTime: 8 },
        squats: { sets: 2, reps: 9, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 30 },
        scapula: { sets: 2, reps: 11 },
        velo: { durationMin: 16 }
      },
      // P√©riode 7: 11-14 f√©v
      {
        adductions: { sets: 2, reps: 9, holdTime: 8 },
        squats: { sets: 2, reps: 9, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 30 },
        scapula: { sets: 2, reps: 12 },
        velo: { durationMin: 16 }
      },
      // P√©riode 8: 15-18 f√©v
      {
        adductions: { sets: 2, reps: 10, holdTime: 8 },
        squats: { sets: 2, reps: 10, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 35 },
        scapula: { sets: 2, reps: 13 },
        velo: { durationMin: 18 }
      },
      // P√©riode 9: 19-22 f√©v
      {
        adductions: { sets: 2, reps: 10, holdTime: 8 },
        squats: { sets: 2, reps: 10, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 35 },
        scapula: { sets: 2, reps: 14 },
        velo: { durationMin: 18 }
      },
      // P√©riode 10: 23-26 f√©v
      {
        adductions: { sets: 2, reps: 11, holdTime: 8 },
        squats: { sets: 2, reps: 11, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 40 },
        scapula: { sets: 2, reps: 15 },
        velo: { durationMin: 20 }
      },
      // P√©riode 11: 27 f√©v - 2 mars
      {
        adductions: { sets: 2, reps: 12, holdTime: 8 },
        squats: { sets: 2, reps: 12, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 40 },
        scapula: { sets: 2, reps: 16 },
        velo: { durationMin: 20 }
      },
      // P√©riode 12: 3-6 mars (d√©but s√©rie 3)
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 4 },
        squats: { sets: 2, reps: 12, descente: 3 },
        chaiseMur: { sets: 2, holdTime: 45 },
        scapula: { sets: 2, reps: 17 },
        velo: { durationMin: 22 }
      },
      // P√©riode 13: 7-10 mars
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 5 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 4 },
        chaiseMur: { sets: 2, holdTime: 45 },
        scapula: { sets: 2, reps: 18 },
        velo: { durationMin: 22 }
      },
      // P√©riode 14: 11-14 mars
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 6 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 5 },
        chaiseMur: { sets: 2, holdTime: 45 },
        scapula: { sets: 2, reps: 20 },
        velo: { durationMin: 24 }
      },
      // P√©riode 15: 15-18 mars (d√©but chaise mur s√©rie 3)
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 7 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 6 },
        chaiseMur: { sets: 2, holdTime: 45, extraSets: 1, extraHoldTime: 10 },
        scapula: { sets: 2, reps: 20, extraSets: 1, extraReps: 6 },
        velo: { durationMin: 24 }
      },
      // P√©riode 16: 19-22 mars
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 8 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 7 },
        chaiseMur: { sets: 2, holdTime: 45, extraSets: 1, extraHoldTime: 15 },
        scapula: { sets: 2, reps: 20, extraSets: 1, extraReps: 8 },
        velo: { durationMin: 26 }
      },
      // P√©riode 17: 23-26 mars
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 9 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 8 },
        chaiseMur: { sets: 2, holdTime: 45, extraSets: 1, extraHoldTime: 20 },
        scapula: { sets: 2, reps: 20, extraSets: 1, extraReps: 10 },
        velo: { durationMin: 26 }
      },
      // P√©riode 18: 27-30 mars
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 10 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 9 },
        chaiseMur: { sets: 2, holdTime: 45, extraSets: 1, extraHoldTime: 25 },
        scapula: { sets: 2, reps: 20, extraSets: 1, extraReps: 12 },
        velo: { durationMin: 28 }
      },
      // P√©riode 19: 31 mars - 3 avr
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 11 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 10 },
        chaiseMur: { sets: 2, holdTime: 45, extraSets: 1, extraHoldTime: 30 },
        scapula: { sets: 2, reps: 20, extraSets: 1, extraReps: 14 },
        velo: { durationMin: 28 }
      },
      // P√©riode 20: 4-7 avr
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 12 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 11 },
        chaiseMur: { sets: 2, holdTime: 45, extraSets: 1, extraHoldTime: 35 },
        scapula: { sets: 2, reps: 20, extraSets: 1, extraReps: 16 },
        velo: { durationMin: 30 }
      },
      // P√©riode 21: 8-11 avr
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 12 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 12 },
        chaiseMur: { sets: 2, holdTime: 45, extraSets: 1, extraHoldTime: 40 },
        scapula: { sets: 2, reps: 20, extraSets: 1, extraReps: 18 },
        velo: { durationMin: 30 }
      },
      // P√©riode 22: 12-14 avr (finale)
      {
        adductions: { sets: 2, reps: 12, holdTime: 8, extraSets: 1, extraReps: 12 },
        squats: { sets: 2, reps: 12, descente: 3, extraSets: 1, extraReps: 12 },
        chaiseMur: { sets: 2, holdTime: 45, extraSets: 1, extraHoldTime: 45 },
        scapula: { sets: 2, reps: 20, extraSets: 1, extraReps: 20 },
        velo: { durationMin: 30 }
      }
    ];

    // D√©finition des exercices
    const EXERCISES = {
      adductions: {
        id: 'adductions',
        name: 'Adductions √©lastique',
        icon: 'ü™ë',
        gradient: ['#10B981', '#34D399'],
        position: 'Assis sur chaise, pieds au sol (largeur bassin), √©lastique au-dessus des genoux, dos soutenu.',
        steps: [
          { text: 'Grandis-toi sur la chaise', detail: 'Cage thoracique au-dessus du bassin' },
          { text: 'Pousse les genoux vers l\'ext√©rieur', detail: 'Contre l\'√©lastique, effort 20-40%' },
          { text: 'Maintiens X secondes', detail: 'Sans te pencher, sans serrer le ventre' },
          { text: 'Rel√¢che compl√®tement', detail: 'Repos 5 secondes entre chaque rep' }
        ],
        feel: 'Activation sur le c√¥t√© de la fesse (partie arri√®re-lat√©rale)',
        warnings: ['Ne te penche pas', '√âvite le serrage abdominal', 'N\'utilise pas trop de force']
      },
      squats: {
        id: 'squats',
        name: 'Squats chaise',
        icon: 'üèãÔ∏è',
        gradient: ['#EF4444', '#F87171'],
        position: 'Assis sur chaise haute, pieds sous les genoux, largeur bassin.',
        steps: [
          { text: 'Adopte un "dos long"', detail: 'Ne cambre pas le dos' },
          { text: 'Penche l√©g√®rement le buste', detail: 'Charni√®re au niveau des hanches' },
          { text: 'L√®ve-toi en poussant le sol', detail: 'Utilise tes jambes, pas ton dos' },
          { text: 'Redescends en 3 secondes', detail: 'Contr√¥le, touche la chaise, remonte' }
        ],
        feel: 'Cuisses et fessiers qui travaillent ensemble',
        warnings: ['Pas de coup de rein', 'Genou align√© (pas vers l\'int√©rieur)', 'Descente contr√¥l√©e 3s']
      },
      chaiseMur: {
        id: 'chaiseMur',
        name: 'Chaise au mur',
        icon: 'üß±',
        gradient: ['#F59E0B', '#FBBF24'],
        position: 'Dos plaqu√© contre le mur, pieds √† 50cm du mur, largeur bassin.',
        steps: [
          { text: 'Descends en glissant le dos', detail: 'Jusqu\'√† angle confortable (pas forc√©ment 90¬∞)' },
          { text: 'Garde le dos plaqu√© au mur', detail: '√âpaules et bas du dos contre le mur' },
          { text: 'Maintiens la position', detail: 'Respire normalement' },
          { text: 'Remonte en poussant dans les talons', detail: 'Contr√¥le la remont√©e' }
        ],
        feel: 'Quadriceps qui br√ªlent, pas de tension lombaire',
        warnings: ['Stop si lombaires se crispent', 'Stop si ventre se serre', 'Angle confortable suffit']
      },
      scapula: {
        id: 'scapula',
        name: 'Plan scapula (2kg)',
        icon: 'üèãÔ∏è‚Äç‚ôÇÔ∏è',
        gradient: ['#8B5CF6', '#A78BFA'],
        position: 'Debout, pieds largeur bassin, alt√®res 2kg en main, bras le long du corps.',
        steps: [
          { text: 'Tiens les alt√®res bras tendus', detail: 'Coudes l√©g√®rement d√©verrouill√©s' },
          { text: 'L√®ve les bras devant toi', detail: 'Dans le plan de la scapula (angle 130-140¬∞ avec le torse)' },
          { text: 'Monte jusqu\'√† hauteur d\'√©paules', detail: 'Pas plus haut' },
          { text: 'Redescends lentement', detail: 'Contr√¥le sur 2-3 secondes' }
        ],
        feel: 'Travail des √©paules et stabilisateurs du haut du dos',
        warnings: ['Ne cambre pas le dos', 'Ne monte pas trop haut', 'Garde les √©paules basses']
      },
      velo: {
        id: 'velo',
        name: 'V√©lo (mod√©r√©)',
        icon: 'üö¥',
        gradient: ['#0EA5E9', '#38BDF8'],
        position: 'Selle haute (genou l√©g√®rement fl√©chi en bas), soutien lombaire, r√©sistance mod√©r√©e.',
        steps: [
          { text: 'R√®gle ta selle correctement', detail: 'Genou l√©g√®rement fl√©chi en bas de p√©dale' },
          { text: 'P√©dale √† rythme confortable', detail: 'Tu dois pouvoir parler (RPE 3-4)' },
          { text: 'Garde une r√©sistance mod√©r√©e', detail: 'Pas trop facile, pas essouffl√©' },
          { text: 'Fais des pauses si besoin', detail: 'L√®ve-toi quelques secondes si inconfort' }
        ],
        feel: 'Effort mod√©r√©, jambes qui travaillent',
        warnings: ['√âvite l\'intensit√© trop forte', 'Ne te penche pas en avant']
      }
    };

    const MONTHS = ['janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao√ªt', 'septembre', 'octobre', 'novembre', 'd√©cembre'];
    const DAYS_SHORT = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];

    // ============================================
    // STATE
    // ============================================
    let currentDate = new Date();
    let completed = {};
    let currentEx = null;
    let exStep = 'intro';
    let feedback = null;
    let timerVal = 0;
    let timerRunning = false;
    let timerInterval = null;
    let repCount = 0;
    let setCount = 1;
    let holding = false;
    let holdTime = 0;
    let holdInterval = null;

    // ============================================
    // HELPERS
    // ============================================
    function getDaysDiff(date) {
      const diffTime = date.getTime() - START_DATE.getTime();
      return Math.floor(diffTime / (1000 * 60 * 60 * 24));
    }

    function getPeriodIndex(date) {
      const days = getDaysDiff(date);
      if (days < 0) return -1;
      const period = Math.floor(days / 4);
      if (period >= PROGRESSION.length) return -2;
      return period;
    }

    function getCurrentDosages() {
      const periodIndex = getPeriodIndex(currentDate);
      if (periodIndex < 0) return null;
      return PROGRESSION[periodIndex];
    }

    function formatDosage(exId, dosage) {
      if (!dosage) return '';
      
      if (exId === 'velo') {
        return `${dosage.durationMin} min`;
      }
      
      if (exId === 'chaiseMur') {
        let text = `${dosage.sets}√ó${dosage.holdTime}s`;
        if (dosage.extraSets) {
          text += ` + ${dosage.extraSets}√ó${dosage.extraHoldTime}s`;
        }
        return text;
      }
      
      if (exId === 'adductions') {
        let text = `${dosage.sets}√ó${dosage.reps}√ó${dosage.holdTime}s`;
        if (dosage.extraSets) {
          text += ` + ${dosage.extraSets}√ó${dosage.extraReps}√ó${dosage.holdTime}s`;
        }
        return text;
      }
      
      if (exId === 'squats') {
        let text = `${dosage.sets}√ó${dosage.reps}`;
        if (dosage.extraSets) {
          text += ` + ${dosage.extraSets}√ó${dosage.extraReps}`;
        }
        text += ' (3s desc.)';
        return text;
      }
      
      if (exId === 'scapula') {
        let text = `${dosage.sets}√ó${dosage.reps}`;
        if (dosage.extraSets) {
          text += ` + ${dosage.extraSets}√ó${dosage.extraReps}`;
        }
        return text;
      }
      
      return '';
    }

    function getTotalSetsAndReps(exId, dosage) {
      if (!dosage) return { sets: 1, reps: 1, holdTime: null, durationMin: null };
      
      if (exId === 'velo') {
        return { sets: 1, reps: null, holdTime: null, durationMin: dosage.durationMin };
      }
      
      if (exId === 'chaiseMur') {
        const totalSets = dosage.sets + (dosage.extraSets || 0);
        // Pour chaise mur, on traite comme des sets avec holdTime
        const holdTimes = [];
        for (let i = 0; i < dosage.sets; i++) holdTimes.push(dosage.holdTime);
        if (dosage.extraSets) {
          for (let i = 0; i < dosage.extraSets; i++) holdTimes.push(dosage.extraHoldTime);
        }
        return { sets: totalSets, reps: 1, holdTime: holdTimes, durationMin: null, isChaiseMur: true };
      }
      
      if (exId === 'adductions') {
        const totalSets = dosage.sets + (dosage.extraSets || 0);
        const repsPerSet = [];
        for (let i = 0; i < dosage.sets; i++) repsPerSet.push(dosage.reps);
        if (dosage.extraSets) {
          for (let i = 0; i < dosage.extraSets; i++) repsPerSet.push(dosage.extraReps);
        }
        return { sets: totalSets, repsPerSet, holdTime: dosage.holdTime, durationMin: null };
      }
      
      if (exId === 'squats') {
        const totalSets = dosage.sets + (dosage.extraSets || 0);
        const repsPerSet = [];
        for (let i = 0; i < dosage.sets; i++) repsPerSet.push(dosage.reps);
        if (dosage.extraSets) {
          for (let i = 0; i < dosage.extraSets; i++) repsPerSet.push(dosage.extraReps);
        }
        return { sets: totalSets, repsPerSet, holdTime: null, durationMin: null };
      }
      
      if (exId === 'scapula') {
        const totalSets = dosage.sets + (dosage.extraSets || 0);
        const repsPerSet = [];
        for (let i = 0; i < dosage.sets; i++) repsPerSet.push(dosage.reps);
        if (dosage.extraSets) {
          for (let i = 0; i < dosage.extraSets; i++) repsPerSet.push(dosage.extraReps);
        }
        return { sets: totalSets, repsPerSet, holdTime: null, durationMin: null };
      }
      
      return { sets: 1, reps: 1, holdTime: null, durationMin: null };
    }

    // ============================================
    // RENDER
    // ============================================
    function render() {
      const periodIndex = getPeriodIndex(currentDate);
      const dosages = getCurrentDosages();
      const daysDiff = getDaysDiff(currentDate);
      const totalDays = getDaysDiff(END_DATE);
      const progress = Math.max(0, Math.min(100, (daysDiff / totalDays) * 100));
      
      const dayNum = currentDate.getDate();
      const monthName = MONTHS[currentDate.getMonth()];
      const dayName = DAYS_SHORT[currentDate.getDay()];
      
      let content = '';
      
      if (periodIndex === -1) {
        // Avant le d√©but
        content = `
          <div class="out-of-range">
            <span>üìÖ</span>
            <h2>Programme pas encore commenc√©</h2>
            <p>Le programme d√©bute le <strong>14 janvier 2026</strong>.<br>Reviens √† cette date pour commencer !</p>
          </div>
        `;
      } else if (periodIndex === -2) {
        // Apr√®s la fin
        content = `
          <div class="out-of-range">
            <span>üéâ</span>
            <h2>Programme termin√© !</h2>
            <p>F√©licitations, tu as compl√©t√© les 3 mois du programme.<br>Continue √† maintenir tes acquis !</p>
          </div>
        `;
      } else {
        // Dans le programme
        const exerciseOrder = ['adductions', 'squats', 'chaiseMur', 'scapula', 'velo'];
        const completedCount = Object.keys(completed).filter(id => completed[id]).length;
        
        content = `
          <div class="header">
            <h1>Programme du jour</h1>
            <p>${completedCount}/5 exercices compl√©t√©s</p>
          </div>
          
          <div class="ex-list">
            ${exerciseOrder.map(exId => {
              const ex = EXERCISES[exId];
              const dosage = dosages[exId];
              const done = !!completed[exId];
              const dosageText = formatDosage(exId, dosage);
              
              return `
                <div class="ex-card ${done ? 'done' : ''}" onclick="openExercise('${exId}')">
                  <div class="ex-card-accent" style="background: linear-gradient(180deg, ${ex.gradient[0]}, ${ex.gradient[1]})"></div>
                  <div class="ex-card-icon" style="background: linear-gradient(135deg, ${ex.gradient[0]}40, ${ex.gradient[1]}40)">${ex.icon}</div>
                  <div class="ex-card-body">
                    <div class="ex-card-top">
                      <h3>${ex.name}</h3>
                    </div>
                    <div class="ex-card-dosage">${dosageText}</div>
                  </div>
                  <div class="ex-card-action">
                    ${done ? `<div class="ex-card-check"><svg viewBox="0 0 24 24" fill="white"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>` : `<svg class="ex-card-arrow" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>`}
                  </div>
                </div>
              `;
            }).join('')}
          </div>
          
          <div class="status-bar">
            <div class="status-item ${completedCount === 5 ? 'done' : ''}">
              ${completedCount === 5 ? '‚úì Journ√©e compl√®te' : `${5 - completedCount} restant${5 - completedCount > 1 ? 's' : ''}`}
            </div>
          </div>
        `;
      }
      
      document.getElementById('app').innerHTML = `
        <div class="date-picker">
          <button class="date-btn" onclick="changeDate(-1)">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
          </button>
          <div class="date-display">
            <div class="day">${dayName} ${dayNum}</div>
            <div class="month">${monthName} ${currentDate.getFullYear()}</div>
          </div>
          <button class="date-btn" onclick="changeDate(1)">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/></svg>
          </button>
        </div>
        
        <div class="progress-section">
          <div class="progress-header">
            <span>Progression globale</span>
            <strong>${Math.round(progress)}%</strong>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${progress}%"></div>
          </div>
          ${periodIndex >= 0 ? `
            <div class="period-info">
              <div class="label">P√©riode actuelle</div>
              <div class="value">Jour ${daysDiff + 1} / 91 ‚Äî Bloc ${periodIndex + 1}/23</div>
            </div>
          ` : ''}
        </div>
        
        ${content}
      `;
    }

    function renderExerciseScreen() {
      const ex = EXERCISES[currentEx];
      const dosages = getCurrentDosages();
      const dosage = dosages[currentEx];
      const dosageText = formatDosage(currentEx, dosage);
      const params = getTotalSetsAndReps(currentEx, dosage);
      const screen = document.getElementById('exercise-screen');
      
      // Calcul du nombre de reps pour la s√©rie courante
      let currentReps = 1;
      if (params.repsPerSet) {
        currentReps = params.repsPerSet[setCount - 1] || 1;
      }
      
      // Calcul du holdTime pour la s√©rie courante (chaise mur)
      let currentHoldTime = null;
      if (params.isChaiseMur && Array.isArray(params.holdTime)) {
        currentHoldTime = params.holdTime[setCount - 1] || 30;
      } else if (params.holdTime && !Array.isArray(params.holdTime)) {
        currentHoldTime = params.holdTime;
      }
      
      screen.innerHTML = `
        <div class="ex-header">
          <button class="hdr-btn" onclick="closeExercise()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg></button>
          <h2><span>${ex.icon}</span> ${ex.name}</h2>
          <div class="hdr-spacer"></div>
        </div>
        
        <!-- INTRO -->
        <div class="intro-body" style="display: ${exStep === 'intro' ? 'flex' : 'none'}">
          <div class="intro-hero" style="background: linear-gradient(135deg, ${ex.gradient[0]}, ${ex.gradient[1]})">
            <span>${ex.icon}</span>
            <div class="glow"></div>
          </div>
          
          <div class="info-block dosage">
            <h4><span>üìä</span> Dosage du jour</h4>
            <div class="dosage-display">
              <div class="main">${dosageText}</div>
              ${currentEx === 'squats' ? '<div class="sub">Descente contr√¥l√©e en 3 secondes</div>' : ''}
              ${currentEx === 'scapula' ? '<div class="sub">Alt√®res 2kg ‚Äî Plan scapulaire (130-140¬∞)</div>' : ''}
            </div>
          </div>
          
          <div class="info-block">
            <h4><span>üìç</span> Position de d√©part</h4>
            <p>${ex.position}</p>
          </div>
          
          <div class="info-block">
            <h4><span>‚ñ∂Ô∏è</span> Ex√©cution</h4>
            <ol class="steps-list">
              ${ex.steps.map((s,i) => `<li><div class="num">${i+1}</div><div class="txt"><strong>${s.text}</strong><span>${s.detail}</span></div></li>`).join('')}
            </ol>
          </div>
          
          <div class="info-block success">
            <h4><span>‚úÖ</span> Tu dois sentir</h4>
            <p>${ex.feel}</p>
          </div>
          
          <div class="info-block warning">
            <h4><span>‚ö†Ô∏è</span> √âvite</h4>
            <ul class="warn-list">${ex.warnings.map(w => `<li>${w}</li>`).join('')}</ul>
          </div>
        </div>
        
        <!-- ACTIVE -->
        <div class="active-screen ${exStep === 'active' ? 'show' : ''}">
          <div class="active-bg" style="background: linear-gradient(180deg, ${ex.gradient[0]}20, transparent)"></div>
          ${params.durationMin ? renderTimer(ex, params) : renderRepCounter(ex, params, currentReps, currentHoldTime)}
          <div class="tip-box"><span>üí°</span><p>${ex.feel}</p></div>
        </div>
        
        <!-- FEEDBACK -->
        <div class="feedback-screen ${exStep === 'feedback' ? 'show' : ''}">
          <div class="fb-top">
            <span>üéâ</span>
            <h2>Bravo !</h2>
            <p>Exercice termin√©</p>
          </div>
          <h3 class="fb-title">Comment te sens-tu ?</h3>
          <p class="fb-sub">√âvalue ta r√©ponse √† cet exercice</p>
          <div class="fb-options">
            <div class="fb-opt ${feedback === 'green' ? 'selected' : ''}" onclick="selectFeedback('green')">
              <span class="icon">üü¢</span>
              <div class="txt"><strong>Vert</strong><span>Douleur ‚â§ 2/10 ‚Äî Tout va bien</span></div>
              <div class="check" style="background: var(--green)"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
            </div>
            <div class="fb-opt ${feedback === 'orange' ? 'selected orange' : ''}" onclick="selectFeedback('orange')">
              <span class="icon">üü†</span>
              <div class="txt"><strong>Orange</strong><span>Douleur 3-4/10 ‚Äî Vigilance</span></div>
              <div class="check" style="background: var(--orange)"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
            </div>
            <div class="fb-opt ${feedback === 'red' ? 'selected red' : ''}" onclick="selectFeedback('red')">
              <span class="icon">üî¥</span>
              <div class="txt"><strong>Rouge</strong><span>Douleur ‚â• 5/10 ‚Äî R√©duire</span></div>
              <div class="check" style="background: var(--red)"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
            </div>
          </div>
        </div>
        
        <!-- FOOTER -->
        <div class="intro-footer">
          <div>
            ${exStep === 'intro' ? `
              <button class="btn btn-primary" onclick="startActive()" style="background: linear-gradient(135deg, ${ex.gradient[0]}, ${ex.gradient[1]})">
                Commencer <svg viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>
              </button>
            ` : exStep === 'active' ? `
              <button class="btn btn-secondary" onclick="finishExercise()">Terminer l'exercice</button>
            ` : `
              <button class="btn btn-primary" onclick="completeExercise()" ${!feedback ? 'disabled style="opacity:0.4"' : ''}>Continuer</button>
            `}
          </div>
        </div>
      `;
      
      screen.classList.add('active');
    }

    function renderTimer(ex, params) {
      const total = params.durationMin * 60;
      const elapsed = total - timerVal;
      const pct = (elapsed / total) * 100;
      const circ = 2 * Math.PI * 46;
      const offset = circ - (pct / 100) * circ;
      const mins = Math.floor(timerVal / 60);
      const secs = timerVal % 60;
      
      return `
        <div class="timer">
          <div class="timer-ring">
            <svg viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="46" class="track"/>
              <circle cx="50" cy="50" r="46" class="progress" stroke="${ex.gradient[1]}" stroke-dasharray="${circ}" stroke-dashoffset="${offset}"/>
            </svg>
            <div class="timer-center">
              <div class="timer-time">${mins}:${secs.toString().padStart(2,'0')}</div>
              <div class="timer-label">${timerRunning ? 'En cours' : 'Pause'}</div>
            </div>
          </div>
          <div class="timer-btns">
            <button class="timer-btn sec" onclick="resetTimer()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg></button>
            <button class="timer-btn main" onclick="toggleTimer()" style="background: linear-gradient(135deg, ${ex.gradient[0]}, ${ex.gradient[1]})">
              ${timerRunning ? '<svg viewBox="0 0 24 24" fill="white"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>' : '<svg viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>'}
            </button>
            <button class="timer-btn sec" onclick="finishExercise()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></button>
          </div>
        </div>
      `;
    }

    function renderRepCounter(ex, params, currentReps, currentHoldTime) {
      const total = currentReps || 1;
      const pct = (repCount / total) * 100;
      
      return `
        <div class="rep-counter">
          <div class="set-info">S√©rie ${setCount} sur ${params.sets}</div>
          <div class="rep-circle ${holding ? 'holding' : ''}" onclick="tapRep()">
            <svg viewBox="0 0 100 100">
              <circle cx="50" cy="50" r="46" class="track"/>
              <circle cx="50" cy="50" r="46" class="progress" stroke="${ex.gradient[1]}" stroke-dasharray="${pct * 2.89} 289"/>
            </svg>
            <div class="rep-inner">
              ${holding ? `
                <div class="hold-num">${holdTime}</div>
                <div class="hold-txt">Maintiens</div>
              ` : `
                <div class="rep-num">${repCount}<span class="sep">/</span><span class="tot">${total}</span></div>
                <div class="rep-hint">Tap pour compter</div>
              `}
            </div>
            ${holding ? '<div class="hold-ring"></div>' : ''}
          </div>
          ${currentHoldTime && !holding ? `<div class="hold-info">üí° Maintiens ${currentHoldTime}s par rep</div>` : ''}
        </div>
      `;
    }

    // ============================================
    // ACTIONS
    // ============================================
    function changeDate(delta) {
      currentDate = new Date(currentDate.getTime() + delta * 24 * 60 * 60 * 1000);
      completed = {};  // Reset pour le nouveau jour
      render();
    }

    function openExercise(id) {
      const dosages = getCurrentDosages();
      const dosage = dosages[id];
      const params = getTotalSetsAndReps(id, dosage);
      
      currentEx = id;
      exStep = 'intro';
      feedback = null;
      timerVal = params.durationMin ? params.durationMin * 60 : 0;
      timerRunning = false;
      repCount = 0;
      setCount = 1;
      holding = false;
      
      // Calcul holdTime initial
      if (params.isChaiseMur && Array.isArray(params.holdTime)) {
        holdTime = params.holdTime[0] || 30;
      } else if (params.holdTime && !Array.isArray(params.holdTime)) {
        holdTime = params.holdTime;
      } else {
        holdTime = 0;
      }
      
      renderExerciseScreen();
    }

    function closeExercise() {
      clearInterval(timerInterval);
      clearInterval(holdInterval);
      document.getElementById('exercise-screen').classList.remove('active');
      currentEx = null;
    }

    function startActive() {
      const dosages = getCurrentDosages();
      const dosage = dosages[currentEx];
      const params = getTotalSetsAndReps(currentEx, dosage);
      timerVal = params.durationMin ? params.durationMin * 60 : 0;
      exStep = 'active';
      renderExerciseScreen();
    }

    function toggleTimer() {
      timerRunning = !timerRunning;
      if (timerRunning) {
        timerInterval = setInterval(() => {
          timerVal--;
          if (timerVal <= 0) {
            clearInterval(timerInterval);
            timerRunning = false;
            vibrate([100,50,100,50,100]);
            finishExercise();
          } else {
            renderExerciseScreen();
          }
        }, 1000);
      } else {
        clearInterval(timerInterval);
      }
      renderExerciseScreen();
    }

    function resetTimer() {
      clearInterval(timerInterval);
      const dosages = getCurrentDosages();
      const dosage = dosages[currentEx];
      const params = getTotalSetsAndReps(currentEx, dosage);
      timerVal = params.durationMin * 60;
      timerRunning = false;
      renderExerciseScreen();
    }

    function tapRep() {
      vibrate(30);
      const dosages = getCurrentDosages();
      const dosage = dosages[currentEx];
      const params = getTotalSetsAndReps(currentEx, dosage);
      
      // Calcul holdTime pour la s√©rie courante
      let currentHoldTime = null;
      if (params.isChaiseMur && Array.isArray(params.holdTime)) {
        currentHoldTime = params.holdTime[setCount - 1] || 30;
      } else if (params.holdTime && !Array.isArray(params.holdTime)) {
        currentHoldTime = params.holdTime;
      }
      
      if (currentHoldTime && !holding) {
        holding = true;
        holdTime = currentHoldTime;
        renderExerciseScreen();
        holdInterval = setInterval(() => {
          holdTime--;
          if (holdTime <= 0) {
            clearInterval(holdInterval);
            holding = false;
            vibrate(100);
            completeRep();
          } else {
            renderExerciseScreen();
          }
        }, 1000);
      } else if (!currentHoldTime) {
        completeRep();
      }
    }

    function completeRep() {
      const dosages = getCurrentDosages();
      const dosage = dosages[currentEx];
      const params = getTotalSetsAndReps(currentEx, dosage);
      
      let currentReps = 1;
      if (params.repsPerSet) {
        currentReps = params.repsPerSet[setCount - 1] || 1;
      }
      
      repCount++;
      
      if (repCount >= currentReps) {
        if (setCount < params.sets) {
          setCount++;
          repCount = 0;
          // Update holdTime pour chaise mur
          if (params.isChaiseMur && Array.isArray(params.holdTime)) {
            holdTime = params.holdTime[setCount - 1] || 30;
          }
        } else {
          vibrate([100,50,100,50,100]);
          finishExercise();
          return;
        }
      }
      
      renderExerciseScreen();
    }

    function finishExercise() {
      clearInterval(timerInterval);
      clearInterval(holdInterval);
      exStep = 'feedback';
      timerRunning = false;
      holding = false;
      renderExerciseScreen();
    }

    function selectFeedback(val) {
      feedback = val;
      renderExerciseScreen();
    }

    function completeExercise() {
      if (!feedback) return;
      completed[currentEx] = feedback;
      closeExercise();
      render();
    }

    function vibrate(pattern) {
      if (navigator.vibrate) navigator.vibrate(pattern);
    }

    // ============================================
    // INIT
    // ============================================
    render();
  </script>

</body>
</html>